###############
# LIVING ROOM #
###############

- id: Double_click_toggle_sofa_lights
  alias: 'Double Click Toggle Sofa Lights'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d0001245482
      click_type: double
  action:
    service: light.toggle
    data:
      entity_id: light.sofa_lights

- id: Single_click_toggle_TV_lights
  alias: 'Single Click Toggle TV Lights'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d0001245482
      click_type: single
  action:
    service: light.toggle
    data:
      entity_id: light.tv_lights


###########
# KITCHEN #
###########

- id: Long_press_toggle_kitchen_lights
  alias: 'Long Press Toggle Kitchen Lights'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d0001245482
      click_type: long_click_press
  action:
    service: light.toggle
    data:
      entity_id: light.kitchen_lights

- id: Turn_on_kitchen_on_motion_at_night_time
  alias: 'Turn ON Kitchen On Motion At Night Time'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_158d00020dc8b6
    from: 'off'
    to: 'on'
  condition:
    condition: or
    conditions:
      - condition: sun
        after: sunset
        after_offset: "-01:00:00"
      - condition: sun
        before: sunrise
        before_offset: "-00:30:00"
  action:
    service: light.turn_on
    data:
      entity_id: light.kitchen_lights

- id: Turn_off_kitchen_after_two_minutes_with_no motion
  alias: 'Turn OFF Kitchen After Two Minutes With No Motion'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_158d00020dc8b6
    from: 'on'
    to: 'off'
    for:
      minutes: 2
  condition:
    condition: or
    conditions:
      - condition: sun
        after: sunset
        after_offset: "-01:00:00"
      - condition: sun
        before: sunrise
        before_offset: "-00:30:00"
  action:
    service: light.turn_off
    data:
      entity_id: light.kitchen_lights



###########
# BEDROOM #
###########

- id: Shake_cube_toggle_lights
  alias: 'Shake Cube Toggle Bed Lights'
  trigger:
    platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.cube_158d00010f0603
      action_type: shake_air
  action:
    service: light.toggle
    entity_id: light.bed_lights

- id: Tap_twice_with_cube_turn_on_light_white_100percent
  alias: 'Tap Twice With Cube Turn ON Light (White - 100 percent)'
  trigger:
    platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.cube_158d00010f0603
      action_type: tap_twice
  action:
    service: light.turn_on
    entity_id: light.bed_lights
    data:
      brightness: 255
      rgb_color: [255,255,255]

- id: flip180_cube_turn_on_light_(orange_30percent)
  alias: 'Flip 180 Cube Turn ON Light (Orange - 30 percent)'
  trigger:
    platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.cube_158d00010f0603
      action_type: flip180
  action:
    service: light.turn_on
    entity_id: light.bed_lights
    data:
      brightness: 76
      rgb_color: [255,165,0]

- id: flip90_cube_toggle_desk_light
  alias: 'Flip 90 Cube Toggle Desk Light'
  trigger:
    platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.cube_158d00010f0603
      action_type: flip90
  action:
    service: light.toggle
    entity_id: light.ludovics_desk


###############
# Shower Room #
###############

#- id: Single_click_toggle_bedroom_lights
#  alias: 'Single Click Toggle Bedroom Lights'
#  trigger:
#    platform: event
#    event_type: xiaomi_aqara.click
#    event_data:
#      entity_id: binary_sensor.switch_158d000121d17f
#      click_type: single
#  action:
#    service: light.toggle
#    data:
#      entity_id: light.bed_lights
#
#- id: Double_click_toggle_shower_room_light
#  alias: 'Double Click Toggle Shower Room Light
#  trigger:
#    platform: event
#    event_type: xiaomi_aqara.click
#    event_data:
#      entity_id: binary_sensor.switch_158d000121d17f
#      click_type: double
#  action:
#    service: light.toggle
#    data:
#      entity_id: light.shower_room

- id: Motion_detected_turn_on_shower_room_light
  alias: 'Motion Detected Turn ON Shower Room Light'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_158d00023666d9
    from: 'off'
    to: 'on'
  action:
    service: light.turn_on
    data:
      entity_id: light.shower_room

- id: No_motion_for_5_minutes_turn_off_shower room light
  alias: 'No Motion For 5 Minutes Turn OFF Shower Room Light'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_158d00023666d9
    from: 'on'
    to: 'off'
    for:
      minutes: 5
  action:
    service: light.turn_off
    data:
      entity_id: light.shower_room


############
# TELEGRAM #
############

- id: Send_daily_report_at_8am
  alias: 'Send Daily Report At 8am'
  trigger:
    platform: time
    at: '08:00:00'
  action:
    service: notify.telegram
    data_template:
      message: |
        早安！
        Today is {{ now().strftime("%B %d, %Y") }}.
        Currently it is {{ states.sensor.dark_sky_summary.state.lower() }}, {{ states.sensor.dark_sky_temperature.state  }}°C with {{ states.sensor.dark_sky_humidity.state | int }}% humidity and AQI is {{ states.sensor.waqi_zhongshan_taiwan.attributes.pm_2_5 }} pm2.5 Taipei.
        The weather will be {{ states.sensor.dark_sky_hourly_summary.state.lower() }}
        You can expect temperatures between {{ states.sensor.dark_sky_daily_low_temperature.state }} and {{ states.sensor.dark_sky_daily_high_temperature.state }} degrees.
        Have a nice day :)

#- id: Send_logs
#  alias: 'Send Logs'
#  trigger:
#    platform: event
#    event_type: telegram_command
#    event_data:
#      command: /logs
#  condition: []
#  action:
#    service: telegram_bot.send_document
#    data:
#      target:
#        - !secret chat_id_telegram_admin
#      file: !secret doc_log
#      disable_notification: true


############
# TELEGRAM #
############

- id: fire_ifttt_event
  alias: 'Fire IFTTT Event'
  trigger:
    platform: event
    event_type: ifttt_webhook_received
    event_data:
      action: call_service
  action:
    service_template: '{{ trigger.event.data.service }}'
